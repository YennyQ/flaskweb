{% extends "base.html" %}
{% import "_macros.html" as macros %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}Flasky - 文章{% endblock %}

{% block page_content %}
<div class="view-post">
	<div class="view-title">
		<h2>
			{{ post.title }}
		</h2>
	</div>
	<div class="post-header">
		<table class="post-header" width="100%">
		<tr>
			<td width="5%"><span class="label label-default">分类</span></td>
			<td width="75%"><span class="label label-info">{{ post.category.name }}</span></td>
			<td width="4%" align="left">by:</td>
			<td width="16%" align="left"><a href="{{ url_for('.user', username=post.author.username) }}">{{ post.author.username }}</a></td>
		</tr>
		<tr>
			<td><span class="label label-default">标签</span></td>
			<td>
				{% for tag in post.tags %}
				<span class="label label-warning">{{ tag.name }}</span>
				&nbsp;
				{% endfor %}
			</td>
			<td align="left">发表于</td>
			<td align="left">{{ moment(post.timestamp).format('LLL') }}</td>
		</tr>
		</table>
	</div>
	<div class="post-body">
		{% if post.body_html %}
			{{ post.body_html|safe }}
		{% else %}
			{{ post.body }}
		{% endif %}
	</div>

	<div class="post-footer">
		<a href="{{ url_for('.post', id=post.id) }}">
			<span class="label label-default">链接</span>
		</a>
		<!-- #comments后缀是URL片段，确定滚动条所在的初始位置 -->
		<a href="{{ url_for('.post', id=post.id) }}#comments">
			<span class="label label-default">
				{{ post.comments.count() }} 评论
			</span>

		</a>
		{% if current_user == post.author %}
		<a href="{{ url_for('.edit_post', id=post.id) }}">
			<span class="label label-primary">编辑</span>
		</a>
		{% elif current_user.is_administrator() %}
		<a href="{{ url_for('.edit_post', id=post.id) }}">
			<span class="label label-danger">编辑【管理员】</span>
		</a>
		{% endif %}
	</div>
</div>


<div>
<h4 id="comments">评论</h4>
	{% if current_user.can(Permission.COMMENT) %}
</div>
<div class="comment-form">
	{{ wtf.quick_form(form) }}
</div>
{% endif %}
{% include '_comments.html' %}
{% if pagination %}
<div class="pagination">
	<!-- fragment传入url片段以确定滚动条初始位置 -->
	{{ macros.pagination_widget(pagination, '.post', fragment='#comments', id=post.id) }}
</div>
{% endif %}
{% endblock %}